echo "üìå Running pre-push hook..."

branch_name=$(git symbolic-ref --short HEAD)

# Allowed branch names
exceptions=("main" "develop")

# Check if the branch is in the exceptions list
for exception in "${exceptions[@]}"; do
    if [ "$branch_name" = "$exception" ]; then
        echo "‚úÖ Pushing to '$branch_name' branch is allowed."
        exit 0
    fi
done

# --- Check commit message (latest commit only) ---
commit_msg=$(git log -1 --pretty=%B)

if echo "$commit_msg" | grep -Eq '^(feat|fix|release|chore|hotfix|refactor|test): .+'; then
    echo "‚úÖ Commit message follows Conventional Commits: '$commit_msg'"
    exit 0
else
    echo "‚ùå Commit message does not follow Conventional Commits."
    echo "üëâ Allowed format: 'type: description' where type ‚àà {feat, fix, release, chore, hotfix, refactor, test}"
    echo "Example: feat: add husky pre-push hook"
    exit 1
fi
